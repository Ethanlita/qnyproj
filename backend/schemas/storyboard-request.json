{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Storyboard Request Schema",
  "description": "Input schema for storyboard generation, including existing character and scene bibles for continuity",
  "type": "object",
  "required": ["text"],
  "properties": {
    "text": {
      "type": "string",
      "minLength": 1,
      "maxLength": 100000,
      "description": "Novel text to convert into storyboard (up to 100k characters)"
    },
    "chapterNumber": {
      "type": "integer",
      "minimum": 1,
      "description": "Chapter number for tracking continuity (optional)"
    },
    "existingCharacters": {
      "type": "array",
      "description": "Existing character bible from previous chapters. Qwen should reuse these and add new characters as needed.",
      "items": {
        "type": "object",
        "required": ["name", "role"],
        "properties": {
          "name": {
            "type": "string",
            "description": "Character name (must be unique)"
          },
          "role": {
            "type": "string",
            "enum": ["protagonist", "antagonist", "supporting", "background"],
            "description": "Character's role in the story"
          },
          "appearance": {
            "type": "object",
            "description": "Physical appearance details",
            "properties": {
              "gender": {"type": "string"},
              "age": {"type": "integer", "minimum": 0},
              "hairColor": {"type": "string"},
              "hairStyle": {"type": "string"},
              "eyeColor": {"type": "string"},
              "height": {"type": "string"},
              "build": {"type": "string"},
              "clothing": {
                "type": "array",
                "items": {"type": "string"}
              },
              "distinctiveFeatures": {
                "type": "array",
                "items": {"type": "string"}
              }
            }
          },
          "personality": {
            "type": "array",
            "items": {"type": "string"},
            "description": "Personality traits"
          }
        }
      }
    },
    "existingScenes": {
      "type": "array",
      "description": "Existing scene bible from previous chapters. Qwen should reuse these for recurring locations and add new scenes as needed.",
      "items": {
        "type": "object",
        "required": ["id", "name", "type", "description"],
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^[a-z0-9_]+$",
            "description": "Unique scene identifier (e.g., 'ancient_town_main_street')"
          },
          "name": {
            "type": "string",
            "description": "Human-readable scene name"
          },
          "type": {
            "type": "string",
            "enum": ["indoor", "outdoor", "indoor-outdoor", "natural", "urban", "rural", "fantasy", "abstract"],
            "description": "Scene category"
          },
          "description": {
            "type": "string",
            "description": "Comprehensive scene description"
          },
          "visualCharacteristics": {
            "type": "object",
            "properties": {
              "architecture": {"type": "string"},
              "keyLandmarks": {
                "type": "array",
                "items": {"type": "string"}
              },
              "colorScheme": {"type": "string"},
              "lighting": {
                "type": "object",
                "properties": {
                  "naturalLight": {
                    "type": "string",
                    "enum": ["abundant", "moderate", "limited", "none"]
                  },
                  "artificialLight": {
                    "type": "string",
                    "enum": ["none", "minimal", "moderate", "heavy"]
                  },
                  "lightSources": {
                    "type": "array",
                    "items": {"type": "string"}
                  }
                }
              },
              "atmosphere": {"type": "string"},
              "soundscape": {
                "type": "array",
                "items": {"type": "string"}
              },
              "textures": {
                "type": "array",
                "items": {"type": "string"}
              }
            }
          },
          "spatialLayout": {
            "type": "object",
            "properties": {
              "size": {
                "type": "string",
                "enum": ["cramped", "small", "medium", "large", "vast"]
              },
              "layout": {"type": "string"},
              "keyAreas": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "name": {"type": "string"},
                    "position": {"type": "string"}
                  }
                }
              }
            }
          },
          "timeVariations": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "timeOfDay": {
                  "type": "string",
                  "enum": ["dawn", "morning", "noon", "afternoon", "dusk", "evening", "night", "midnight"]
                },
                "description": {"type": "string"}
              }
            }
          },
          "weatherVariations": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "weather": {
                  "type": "string",
                  "enum": ["clear", "cloudy", "rainy", "snowy", "foggy", "stormy", "windy"]
                },
                "description": {"type": "string"}
              }
            }
          },
          "narrativeRole": {
            "type": "string",
            "enum": ["primary-setting", "secondary-setting", "transitional", "symbolic", "flashback-location", "dream-sequence"]
          },
          "firstAppearance": {
            "type": "object",
            "properties": {
              "chapter": {"type": "integer", "minimum": 1},
              "page": {"type": "integer", "minimum": 1},
              "panelIndex": {"type": "integer", "minimum": 0}
            }
          },
          "referenceImages": {
            "type": "array",
            "items": {"type": "string"}
          }
        }
      }
    },
    "novelId": {
      "type": "string",
      "description": "Novel ID for linking to the bible storage (optional)"
    }
  }
}
