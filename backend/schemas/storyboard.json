{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Storyboard Schema",
  "description": "JSON Schema for comic storyboard generation from novel text",
  "type": "object",
  "required": ["panels", "characters", "scenes"],
  "properties": {
    "panels": {
      "type": "array",
      "minItems": 1,
      "description": "Array of comic panels in sequential order",
      "items": {
        "type": "object",
        "required": ["page", "index", "scene", "shotType", "cameraAngle", "background", "atmosphere"],
        "properties": {
          "page": {
            "type": "integer",
            "minimum": 1,
            "description": "Page number (1-based)"
          },
          "index": {
            "type": "integer",
            "minimum": 0,
            "maximum": 5,
            "description": "Panel index on the page (0-5, 6 panels per page)"
          },
          "scene": {
            "type": "string",
            "minLength": 1,
            "maxLength": 800,
            "description": "Comprehensive scene description including setting, action, and mood"
          },
          "background": {
            "type": "object",
            "required": ["setting", "timeOfDay"],
            "description": "Background environment details",
            "properties": {
              "sceneId": {
                "type": "string",
                "description": "Reference to scene bible entry (e.g., 'main_street', 'school_library'). Use this to maintain consistency for recurring locations."
              },
              "setting": {
                "type": "string",
                "description": "Location/environment description (e.g., '古镇石板街道', '图书馆内部', '樱花树下')"
              },
              "timeOfDay": {
                "type": "string",
                "enum": ["dawn", "morning", "noon", "afternoon", "dusk", "evening", "night", "midnight"],
                "description": "Time of day for lighting reference"
              },
              "weather": {
                "type": "string",
                "enum": ["clear", "cloudy", "rainy", "snowy", "foggy", "stormy", "windy"],
                "description": "Weather conditions affecting the scene"
              },
              "lighting": {
                "type": "string",
                "enum": ["natural", "artificial", "dramatic", "soft", "harsh", "backlit", "silhouette"],
                "description": "Lighting style and quality"
              },
              "details": {
                "type": "array",
                "description": "Specific background elements (e.g., '远处的山峦', '街边的灯笼', '飘落的樱花')",
                "items": {
                  "type": "string"
                }
              }
            }
          },
          "atmosphere": {
            "type": "object",
            "required": ["mood"],
            "description": "Emotional and sensory atmosphere",
            "properties": {
              "mood": {
                "type": "string",
                "enum": [
                  "peaceful", "tense", "romantic", "mysterious", "melancholic", 
                  "joyful", "dramatic", "calm", "chaotic", "nostalgic", "ominous", "hopeful"
                ],
                "description": "Overall emotional tone of the panel"
              },
              "soundEffects": {
                "type": "array",
                "description": "Sound effects present in the scene",
                "items": {
                  "type": "object",
                  "required": ["sound", "style"],
                  "properties": {
                    "sound": {
                      "type": "string",
                      "description": "Sound description (e.g., '脚步声', '风声', '心跳')"
                    },
                    "style": {
                      "type": "string",
                      "enum": ["subtle", "prominent", "emphasized"],
                      "description": "Visual prominence of the sound effect"
                    }
                  }
                }
              },
              "particleEffects": {
                "type": "array",
                "description": "Visual particle effects (e.g., '花瓣飘落', '雪花飞舞', '光尘')",
                "items": {
                  "type": "string"
                }
              }
            }
          },
          "shotType": {
            "type": "string",
            "enum": ["close-up", "medium", "wide", "extreme-wide", "extreme-close-up", "cowboy-shot"],
            "description": "Camera shot distance/framing"
          },
          "cameraAngle": {
            "type": "string",
            "enum": ["eye-level", "high-angle", "low-angle", "birds-eye", "worms-eye", "dutch-angle", "over-shoulder"],
            "description": "Camera angle perspective"
          },
          "composition": {
            "type": "object",
            "description": "Visual composition and framing",
            "properties": {
              "focusPoint": {
                "type": "string",
                "description": "Main focal point of the panel (e.g., '女孩的眼睛', '两人的轮廓')"
              },
              "depthOfField": {
                "type": "string",
                "enum": ["shallow", "deep", "normal"],
                "description": "Focus depth (shallow=blurred background, deep=everything sharp)"
              },
              "rule": {
                "type": "string",
                "enum": ["rule-of-thirds", "centered", "golden-ratio", "symmetrical", "dynamic"],
                "description": "Compositional guideline used"
              }
            }
          },
          "artStyle": {
            "type": "object",
            "description": "Visual art style specifications",
            "properties": {
              "genre": {
                "type": "string",
                "enum": ["shonen", "shoujo", "seinen", "josei", "realistic", "chibi", "sketch"],
                "description": "Manga/art genre style"
              },
              "lineWeight": {
                "type": "string",
                "enum": ["thin", "medium", "thick", "varied"],
                "description": "Line art thickness"
              },
              "shading": {
                "type": "string",
                "enum": ["screentone", "crosshatch", "cel-shading", "soft-shading", "high-contrast"],
                "description": "Shading technique"
              },
              "colorPalette": {
                "type": "string",
                "description": "Color scheme description (e.g., 'warm sunset tones', 'cool blues', 'monochrome')"
              }
            }
          },
          "characters": {
            "type": "array",
            "description": "Characters appearing in this panel",
            "items": {
              "type": "object",
              "required": ["name"],
              "properties": {
                "name": {
                  "type": "string",
                  "minLength": 1,
                  "description": "Character name"
                },
                "pose": {
                  "type": "string",
                  "description": "Character pose/body language description"
                },
                "expression": {
                  "type": "string",
                  "enum": [
                    "neutral", "happy", "sad", "angry", "surprised", "determined", 
                    "fearful", "confused", "excited", "shy", "disgusted", "contempt",
                    "anxious", "loving", "jealous", "proud"
                  ],
                  "description": "Character facial expression"
                },
                "position": {
                  "type": "string",
                  "enum": ["foreground", "midground", "background"],
                  "description": "Character's depth position in the scene"
                }
              }
            }
          },
          "dialogue": {
            "type": "array",
            "description": "Dialogue bubbles in this panel",
            "items": {
              "type": "object",
              "required": ["speaker", "text"],
              "properties": {
                "speaker": {
                  "type": "string",
                  "description": "Name of the speaker (or 'narration' for narrative text)"
                },
                "text": {
                  "type": "string",
                  "minLength": 1,
                  "maxLength": 200,
                  "description": "Dialogue text content"
                },
                "bubbleType": {
                  "type": "string",
                  "enum": ["speech", "thought", "narration", "scream", "whisper", "shout"],
                  "default": "speech",
                  "description": "Type of dialogue bubble"
                },
                "emotion": {
                  "type": "string",
                  "enum": ["calm", "excited", "angry", "sad", "fearful", "surprised"],
                  "description": "Emotional tone of the dialogue"
                }
              }
            }
          },
          "visualPrompt": {
            "type": "string",
            "description": "Comprehensive English prompt for AI image generation (Imagen 3, Midjourney, etc.)"
          },
          "narrativeFunction": {
            "type": "string",
            "enum": [
              "establishing-shot", "action", "reaction", "dialogue", "transition", 
              "dramatic-reveal", "flashback", "montage", "emotional-beat"
            ],
            "description": "Narrative purpose of this panel in storytelling"
          }
        }
      }
    },
    "characters": {
      "type": "array",
      "minItems": 1,
      "description": "Character bible - all characters appearing in the story",
      "items": {
        "type": "object",
        "required": ["name", "role"],
        "properties": {
          "name": {
            "type": "string",
            "minLength": 1,
            "description": "Character name"
          },
          "role": {
            "type": "string",
            "enum": ["protagonist", "antagonist", "supporting", "background"],
            "description": "Character role in the story"
          },
          "appearance": {
            "type": "object",
            "description": "Physical appearance description",
            "properties": {
              "gender": {
                "type": "string",
                "enum": ["male", "female", "other"],
                "description": "Character gender"
              },
              "age": {
                "type": "integer",
                "minimum": 0,
                "maximum": 150,
                "description": "Character age"
              },
              "hairColor": {
                "type": "string",
                "description": "Hair color (e.g., 'black', 'blonde', 'red')"
              },
              "hairStyle": {
                "type": "string",
                "description": "Hair style (e.g., 'long', 'short', 'ponytail')"
              },
              "eyeColor": {
                "type": "string",
                "description": "Eye color"
              },
              "height": {
                "type": "string",
                "description": "Height description (e.g., 'tall', 'average', 'short')"
              },
              "build": {
                "type": "string",
                "description": "Body build (e.g., 'slim', 'athletic', 'muscular')"
              },
              "clothing": {
                "type": "array",
                "description": "Typical clothing items",
                "items": {
                  "type": "string"
                }
              },
              "distinctiveFeatures": {
                "type": "array",
                "description": "Distinctive features (e.g., 'scar on left cheek', 'glasses')",
                "items": {
                  "type": "string"
                }
              }
            }
          },
          "personality": {
            "type": "array",
            "description": "Personality traits",
            "items": {
              "type": "string"
            }
          }
        }
      }
    },
    "scenes": {
      "type": "array",
      "minItems": 1,
      "description": "Scene bible - all recurring locations/settings in the story for visual consistency",
      "items": {
        "type": "object",
        "required": ["id", "name", "type", "description"],
        "properties": {
          "id": {
            "type": "string",
            "minLength": 1,
            "description": "Unique identifier for this scene (e.g., 'main_street', 'school_library', 'protagonist_home')"
          },
          "name": {
            "type": "string",
            "minLength": 1,
            "description": "Scene name (e.g., '小镇主街', '学校图书馆', '李明的家')"
          },
          "type": {
            "type": "string",
            "enum": [
              "indoor", "outdoor", "indoor-outdoor-transition", 
              "natural-environment", "urban", "rural", "fantasy", "abstract"
            ],
            "description": "Scene category type"
          },
          "description": {
            "type": "string",
            "minLength": 10,
            "maxLength": 500,
            "description": "Detailed description of the scene/location"
          },
          "visualCharacteristics": {
            "type": "object",
            "description": "Consistent visual elements of this scene",
            "properties": {
              "architecture": {
                "type": "string",
                "description": "Architectural style and key structures (e.g., '低矮砖房，木门窗，瓦片屋顶')"
              },
              "keyLandmarks": {
                "type": "array",
                "description": "Distinctive landmarks that define this scene",
                "items": {
                  "type": "string"
                }
              },
              "colorScheme": {
                "type": "string",
                "description": "Dominant color palette (e.g., 'warm earth tones', 'cool blues and grays')"
              },
              "lighting": {
                "type": "object",
                "description": "Typical lighting conditions",
                "properties": {
                  "naturalLight": {
                    "type": "string",
                    "enum": ["abundant", "moderate", "limited", "none"],
                    "description": "Amount of natural light"
                  },
                  "artificialLight": {
                    "type": "string",
                    "enum": ["none", "minimal", "moderate", "heavy"],
                    "description": "Artificial lighting presence"
                  },
                  "lightSources": {
                    "type": "array",
                    "description": "Specific light sources (e.g., '街灯', '蜡烛', '窗户')",
                    "items": {
                      "type": "string"
                    }
                  }
                }
              },
              "atmosphere": {
                "type": "string",
                "description": "General atmosphere/feeling of the scene (e.g., 'nostalgic and peaceful', 'busy and modern')"
              },
              "soundscape": {
                "type": "array",
                "description": "Typical ambient sounds in this scene",
                "items": {
                  "type": "string"
                }
              },
              "textures": {
                "type": "array",
                "description": "Dominant textures and materials (e.g., '石板地面', '木质家具', '布质窗帘')",
                "items": {
                  "type": "string"
                }
              }
            }
          },
          "spatialLayout": {
            "type": "object",
            "description": "Spatial organization of the scene",
            "properties": {
              "size": {
                "type": "string",
                "enum": ["cramped", "small", "medium", "large", "vast"],
                "description": "Overall size/scale of the space"
              },
              "layout": {
                "type": "string",
                "description": "Spatial arrangement description (e.g., '狭长的街道，两旁是店铺')"
              },
              "keyAreas": {
                "type": "array",
                "description": "Important sub-areas within the scene",
                "items": {
                  "type": "object",
                  "properties": {
                    "name": {
                      "type": "string",
                      "description": "Sub-area name"
                    },
                    "description": {
                      "type": "string",
                      "description": "Sub-area description"
                    }
                  }
                }
              }
            }
          },
          "timeVariations": {
            "type": "array",
            "description": "How this scene appears at different times",
            "items": {
              "type": "object",
              "required": ["timeOfDay", "description"],
              "properties": {
                "timeOfDay": {
                  "type": "string",
                  "enum": ["dawn", "morning", "noon", "afternoon", "dusk", "evening", "night", "midnight"]
                },
                "description": {
                  "type": "string",
                  "description": "How the scene looks/feels at this time"
                },
                "lightingChanges": {
                  "type": "string",
                  "description": "Specific lighting changes"
                }
              }
            }
          },
          "weatherVariations": {
            "type": "array",
            "description": "How this scene appears in different weather",
            "items": {
              "type": "object",
              "required": ["weather", "description"],
              "properties": {
                "weather": {
                  "type": "string",
                  "enum": ["clear", "cloudy", "rainy", "snowy", "foggy", "stormy", "windy"]
                },
                "description": {
                  "type": "string",
                  "description": "How weather affects the scene's appearance"
                }
              }
            }
          },
          "narrativeRole": {
            "type": "string",
            "enum": [
              "primary-setting", "secondary-setting", "transition-space", 
              "character-sanctuary", "conflict-zone", "symbolic-space"
            ],
            "description": "This scene's role in the narrative"
          },
          "firstAppearance": {
            "type": "object",
            "description": "When this scene first appears in the story",
            "properties": {
              "chapter": {
                "type": "integer",
                "minimum": 1,
                "description": "Chapter number"
              },
              "page": {
                "type": "integer",
                "minimum": 1,
                "description": "Page number"
              },
              "panelIndex": {
                "type": "integer",
                "minimum": 0,
                "description": "Panel index"
              }
            }
          },
          "referenceImages": {
            "type": "array",
            "description": "Reference image URLs or descriptions for consistency",
            "items": {
              "type": "string"
            }
          }
        }
      }
    },
    "totalPages": {
      "type": "integer",
      "minimum": 1,
      "description": "Total number of pages in the storyboard"
    }
  }
}
